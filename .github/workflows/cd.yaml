name: Deploy to Kubernetes

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]


jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: create kubeconfig
        run : |
          mkdir ${HOME}/.kube
          echo ${{ secrets.KUBECONFIG }} | base64 --decode > ${HOME}/.kube/config
          cat ${HOME}/.kube/config 
      - name: use context
        run: kubectl config use-context octobay-api
      - name: deploy to k8s
        run : kubectl apply -f k8s/
